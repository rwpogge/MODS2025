<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ISIS Server: messages.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ISIS Server
   &#160;<span id="projectnumber">Version 2.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">messages.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Server message handling functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="isisserver_8h_source.html">isisserver.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0f0a9c7c089ad37f0fd86fb7d972bf8e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="messages_8c.html#a0f0a9c7c089ad37f0fd86fb7d972bf8e">handleMessage</a> (int sendHost, int destHost, char *msgBody)</td></tr>
<tr class="memdesc:a0f0a9c7c089ad37f0fd86fb7d972bf8e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle messages received by the ISIS server.  <a href="messages_8c.html#a0f0a9c7c089ad37f0fd86fb7d972bf8e">More...</a><br /></td></tr>
<tr class="separator:a0f0a9c7c089ad37f0fd86fb7d972bf8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38ddc2776f407a85aa65072408362cd0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="messages_8c.html#a38ddc2776f407a85aa65072408362cd0">broadcastMessage</a> (int sendHost, char *msgBody)</td></tr>
<tr class="memdesc:a38ddc2776f407a85aa65072408362cd0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcast a message to all clients.  <a href="messages_8c.html#a38ddc2776f407a85aa65072408362cd0">More...</a><br /></td></tr>
<tr class="separator:a38ddc2776f407a85aa65072408362cd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac725233b3f1b484ff972fae5224f4710"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="messages_8c.html#ac725233b3f1b484ff972fae5224f4710">sendMessage</a> (int destHost, char *message)</td></tr>
<tr class="memdesc:ac725233b3f1b484ff972fae5224f4710"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a message string to a client.  <a href="messages_8c.html#ac725233b3f1b484ff972fae5224f4710">More...</a><br /></td></tr>
<tr class="separator:ac725233b3f1b484ff972fae5224f4710"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Server message handling functions. </p>
<p>The ISIS server passes messages between clients using the ICIMACS Messaging Protocol version 2 (IMPv2).</p>
<p>... more to come ... </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a0f0a9c7c089ad37f0fd86fb7d972bf8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f0a9c7c089ad37f0fd86fb7d972bf8e">&#9670;&nbsp;</a></span>handleMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleMessage </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sendHost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>destHost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msgBody</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle messages received by the ISIS server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sendHost</td><td>Client table index of the sending client host </td></tr>
    <tr><td class="paramname">destHost</td><td>Client table index of the destination host </td></tr>
    <tr><td class="paramname">msgBody</td><td>Body of the message</td></tr>
  </table>
  </dd>
</dl>
<p>Figures out what to do with a message received and already validated by the calling procedure. There are three possibilities: </p><ol>
<li>
It is an ISIS server command request to be passed to <a class="el" href="commands_8c.html#a0b6c90731f359a749d70058fdec67de6" title="Process an ISIS server command.">isisCommand()</a> for processing. </li>
<li>
It is a broadcast message to be copied out to all known ISIS client hosts (passed to <a class="el" href="messages_8c.html#a38ddc2776f407a85aa65072408362cd0" title="Broadcast a message to all clients.">broadcastMessage()</a>), as well as being processed by the server proper (passed to <a class="el" href="commands_8c.html#a0b6c90731f359a749d70058fdec67de6" title="Process an ISIS server command.">isisCommand()</a>). </li>
<li>
It is a message to be routed to another client host using <a class="el" href="messages_8c.html#ac725233b3f1b484ff972fae5224f4710" title="Send a message string to a client.">sendMessage()</a>. </li>
</ol>
<p>This routine is designed to be safe for future multithreading.</p>
<p>IMPv2 messages are terminated with return (\r = ASCII 13), not with a newline (\n = ASCII 10). Messages prepared for further routing by <a class="el" href="messages_8c.html#ac725233b3f1b484ff972fae5224f4710" title="Send a message string to a client.">sendMessage()</a> must be correctly terminated. Those printed to stdout do not require termination, as the printing routine will strip any termination and provide a \r as required.</p>
<p>BEWARE: No terminination checking is done by <a class="el" href="messages_8c.html#ac725233b3f1b484ff972fae5224f4710" title="Send a message string to a client.">sendMessage()</a>! </p>

<p class="reference">References <a class="el" href="isisserver_8h.html#a896538c6c44ade4695fbcecf857dae48">BIG_STR_SIZE</a>, <a class="el" href="isisserver_8h.html#ac286e1243ab6be2c950c277e5e1377f9">BROADCAST</a>, <a class="el" href="messages_8c.html#a38ddc2776f407a85aa65072408362cd0">broadcastMessage()</a>, <a class="el" href="isisd_8c.html#a5161091915979e087808cd51249dbecf">clientTab</a>, <a class="el" href="structclients.html#a9a4480c8cf82167ebe1593b49dae6a61">clients::ID</a>, <a class="el" href="isisd_8c.html#a87937aa5e68dbe69f06e693a4b9b87a6">isis</a>, <a class="el" href="isisserver_8h.html#af6b9772636617ee4660660fbcab9f631">ISIS_MSGSIZE</a>, <a class="el" href="isisserver_8h.html#abff6f76b9ef26ab43a3c2ae256e1974a">ISIS_SERVER</a>, <a class="el" href="commands_8c.html#a0b6c90731f359a749d70058fdec67de6">isisCommand()</a>, <a class="el" href="structserver.html#ab0704958386b2a2daecfb1f8d028fc2e">server::isVerbose</a>, <a class="el" href="isisserver_8h.html#a50f178fc99e82ee6564cfcd5792d5935">logMessage()</a>, <a class="el" href="isisserver_8h.html#a2ba44992645c603bc25063438192961b">MSG_ECHO</a>, <a class="el" href="isisserver_8h.html#a4b7e81ccc83bcce7a207c59abeca4f17">MSG_FORWARD</a>, <a class="el" href="isisserver_8h.html#a7c34a2b91fee37875d5aa30756242aa1">MSG_NOOP</a>, <a class="el" href="isisserver_8h.html#a42316d489e809e8faf0bf766fe7a1039">MSG_REPLY</a>, <a class="el" href="messages_8c.html#ac725233b3f1b484ff972fae5224f4710">sendMessage()</a>, <a class="el" href="structserver.html#acbe78cdc6cc95d85c5b8e6831a8e861e">server::serverID</a>, and <a class="el" href="structserver.html#afd5985cc10d0f6b5681a0f6028e34352">server::useCLI</a>.</p>

<p class="reference">Referenced by <a class="el" href="isisserver_8h.html#a84f23e6e062badcef82b8a3f536a589f">broadcastMessage()</a>, <a class="el" href="interfaces_8c.html#a2a0827acfe57492012f3e4cdb6e3c530">serialHandler()</a>, <a class="el" href="interfaces_8c.html#a0dfcbfecb48c09ef71ba42573fabadf1">socketHandler()</a>, and <a class="el" href="interfaces_8c.html#af28ab32ad94422e202107ebd3cc5ed20">ttyHandler()</a>.</p>

</div>
</div>
<a id="a38ddc2776f407a85aa65072408362cd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38ddc2776f407a85aa65072408362cd0">&#9670;&nbsp;</a></span>broadcastMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void broadcastMessage </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sendHost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msgBody</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcast a message to all clients. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sendHost</td><td>Client table index of the sending host </td></tr>
    <tr><td class="paramname">msgBody</td><td>Body of the broadcast message.</td></tr>
  </table>
  </dd>
</dl>
<p>Sends a broadcast message out to all known clients on the system. Broadcast messages take the form of </p><pre class="fragment">XX&gt;AL message_text\r </pre><p> If XX is the local host, we pass it to all ports in this order: </p><ol>
<li>
to each active serial port </li>
<li>
to each active network client </li>
</ol>
<p>If XX is one of our known clients, we pass the message along only to ports other than the one the sending client is using.</p>
<p>This is a key distinction: broadcasts are blind-sent to <em>ports</em> not hosts. We have to be careful not to echo a broadcast back to the sender, which risks starting infinite regressions.</p>
<p>Designed to be lightweight and thread safe. All routines called by this (and the routine itself) must not alter global variables. this means that logging is the responsibility of calling programs upstream. </p>

<p class="reference">References <a class="el" href="isisd_8c.html#a5161091915979e087808cd51249dbecf">clientTab</a>, <a class="el" href="structserial.html#a7bedc29a6c68db47a1e9e3e7e9647359">serial::fd</a>, <a class="el" href="messages_8c.html#a0f0a9c7c089ad37f0fd86fb7d972bf8e">handleMessage()</a>, <a class="el" href="isisd_8c.html#a87937aa5e68dbe69f06e693a4b9b87a6">isis</a>, <a class="el" href="isisserver_8h.html#af6b9772636617ee4660660fbcab9f631">ISIS_MSGSIZE</a>, <a class="el" href="isisserver_8h.html#abff6f76b9ef26ab43a3c2ae256e1974a">ISIS_SERVER</a>, <a class="el" href="isisserver_8h.html#a50f178fc99e82ee6564cfcd5792d5935">logMessage()</a>, <a class="el" href="isisserver_8h.html#ace5c08f66edfc6ae44edaeef6b6101b6">MAXCLIENTS</a>, <a class="el" href="structserver.html#a50f959a59df2fb28e8fcd99923250470">server::numClients</a>, <a class="el" href="structserver.html#a1fb612a824bfdbfdee8051e203cb8387">server::numSerial</a>, <a class="el" href="structclients.html#a5224ea91c429259635b9c60d7b8a5655">clients::port</a>, <a class="el" href="isisserver_8h.html#aae3f0b4211ba45d265973d40ccbb5fd1">SERIAL</a>, <a class="el" href="structserver.html#acbe78cdc6cc95d85c5b8e6831a8e861e">server::serverID</a>, <a class="el" href="isisserver_8h.html#aff55fe551a9992a54ec54621c524d0a4">SOCKET</a>, <a class="el" href="structserver.html#a0cb6c87d8dcf19087e959f185b43a2a9">server::sockFD</a>, <a class="el" href="isisd_8c.html#abaf76ce78c6223f91d80fdafbf19cd63">ttyTab</a>, and <a class="el" href="structserver.html#afd5985cc10d0f6b5681a0f6028e34352">server::useCLI</a>.</p>

<p class="reference">Referenced by <a class="el" href="isisserver_8h.html#afe107bddbb05e66ba9dba28bdeb7a736">handleMessage()</a>, <a class="el" href="isisd_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>, and <a class="el" href="interfaces_8c.html#af28ab32ad94422e202107ebd3cc5ed20">ttyHandler()</a>.</p>

</div>
</div>
<a id="ac725233b3f1b484ff972fae5224f4710"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac725233b3f1b484ff972fae5224f4710">&#9670;&nbsp;</a></span>sendMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendMessage </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>destHost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a message string to a client. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">destHost</td><td>Index of the destination client host in the server's client table </td></tr>
    <tr><td class="paramname">message</td><td>The message to send</td></tr>
  </table>
  </dd>
</dl>
<p>Sends the message to a client. The message must by this point be in the form of a valid IMPv2 protocol message: </p><pre class="fragment">XX&gt;YY message_text\r </pre><p> for passing. The transport mechanism is based on the entries for destHost in the client host table. This presumes that the calling routine has already validated the destination host as valid.</p>
<p>The message must be properly terminated with \r (ASCII 13) as per the IMPv2 message format specification.</p>
<p>Designed to be lightweight and thread safe. All routines called by this (and the routine itself) must not alter global variables. this means that logging is the responsibility of calling programs upstream. </p>

<p class="reference">References <a class="el" href="isisd_8c.html#a5161091915979e087808cd51249dbecf">clientTab</a>, <a class="el" href="structserial.html#a7bedc29a6c68db47a1e9e3e7e9647359">serial::fd</a>, <a class="el" href="isisd_8c.html#a87937aa5e68dbe69f06e693a4b9b87a6">isis</a>, <a class="el" href="isisserver_8h.html#a50f178fc99e82ee6564cfcd5792d5935">logMessage()</a>, <a class="el" href="structclients.html#a5224ea91c429259635b9c60d7b8a5655">clients::port</a>, <a class="el" href="isisserver_8h.html#aae3f0b4211ba45d265973d40ccbb5fd1">SERIAL</a>, <a class="el" href="isisserver_8h.html#aff55fe551a9992a54ec54621c524d0a4">SOCKET</a>, <a class="el" href="structserver.html#a0cb6c87d8dcf19087e959f185b43a2a9">server::sockFD</a>, <a class="el" href="isisd_8c.html#abaf76ce78c6223f91d80fdafbf19cd63">ttyTab</a>, and <a class="el" href="structserver.html#afd5985cc10d0f6b5681a0f6028e34352">server::useCLI</a>.</p>

<p class="reference">Referenced by <a class="el" href="isisserver_8h.html#afe107bddbb05e66ba9dba28bdeb7a736">handleMessage()</a>, <a class="el" href="interfaces_8c.html#a2a0827acfe57492012f3e4cdb6e3c530">serialHandler()</a>, <a class="el" href="interfaces_8c.html#a0dfcbfecb48c09ef71ba42573fabadf1">socketHandler()</a>, and <a class="el" href="interfaces_8c.html#af28ab32ad94422e202107ebd3cc5ed20">ttyHandler()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
